<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Google Sheets</title>
    <!-- Google Identity Services -->
    <script>
        // Prevent Google's auto-initialization before our code runs
        // Google's script looks for g_id_onload function or element
        // We'll prevent it from auto-initializing by not providing either until ready
        window.g_id_onload = null;
    </script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <!-- External Stylesheet for Admin Panel -->
    <link rel="stylesheet" href="https://ernestdarrow.github.io/nelsoncounty/admin.css">
    
    <!-- Quick check: If auth is disabled, hide login immediately -->
    <script>
        // Set skipAuth flag immediately (since admin.js has ENABLE_GOOGLE_AUTH = false)
        // This will be cleared by admin.js if auth is re-enabled
        localStorage.setItem('skipAuth', 'true');
        
        // Hide login overlay immediately
        function hideLoginOverlay() {
            const overlay = document.getElementById('loginOverlay');
            if (overlay) {
                overlay.style.display = 'none';
                document.body.classList.add('logged-in');
            }
        }
        
        // Try immediately
        if (document.body) {
            hideLoginOverlay();
        }
        
        // Also try when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', hideLoginOverlay);
        } else {
            hideLoginOverlay();
        }
        
        // Use MutationObserver as backup
        const observer = new MutationObserver(function(mutations) {
            hideLoginOverlay();
            observer.disconnect();
        });
        if (document.body) {
            observer.observe(document.body, { childList: true, subtree: true });
        }
    </script>
    
    <!-- Critical CSS for login page and initial UI -->
    <style>
        /* Basic reset and body styles */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: #ffffff; 
            color: #212529;
        }
        
        /* Login Overlay - Critical for initial page load */
        #loginOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #4E6B52 0%, #3a5240 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        
        #loginOverlay .login-container {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            max-width: 400px;
            width: 90%;
        }
        
        #loginOverlay h2 {
            color: #4E6B52;
            margin: 0 0 10px 0;
            font-size: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        #loginOverlay p {
            color: #6c757d;
            margin: 0;
            font-size: 14px;
        }
        
        #loginOverlay .login-footer {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #dee2e6;
            text-align: center;
        }
        
        #loginOverlay .login-footer p {
            font-size: 12px;
        }
        
        #g_id_onload {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            min-height: 50px;
            align-items: center;
        }
        
        #fallbackButtonContainer {
            display: none;
            margin-bottom: 20px;
        }
        
        #fallbackButtonContainer button {
            width: 100%;
            background: #4285f4;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: background 0.2s;
        }
        
        #fallbackButtonContainer button:hover {
            background: #357ae8;
        }
        
        #loadingMessage {
            color: #6c757d;
            padding: 20px;
            text-align: center;
        }
        
        #loginError {
            display: none;
            background: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 6px;
            font-size: 14px; 
            text-align: center;
            margin-bottom: 20px;
        }
        
        /* Hide login overlay when logged in */
        body.logged-in #loginOverlay {
            display: none;
        }
        
        /* Ensure content is hidden until logged in */
        body:not(.logged-in) .header,
        body:not(.logged-in) .tabs,
        body:not(.logged-in) .tab-content {
            display: none;
        }
    </style>

</head>
<body>
    <!-- Google OAuth Login Overlay -->
    <div id="loginOverlay">
        <div class="login-container">
            <div style="text-align: center; margin-bottom: 30px;">
                <h2>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                    </svg>
                    Nelson County
                </h2>
                <p>Sign in with your Google account to access the admin panel</p>
            </div>
            
            <div id="googleSignInContainer"></div>
            
            <!-- Fallback manual button if Google's button doesn't load -->
            <div id="fallbackButtonContainer">
                <button onclick="triggerGoogleSignIn()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                        <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                        <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                        <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                    </svg>
                    Sign in with Google
                </button>
                </div>
                
            <div id="loadingMessage">Loading sign-in button...</div>
                
            <div id="loginError">
                <span id="loginErrorText"></span>
            </div>
            
            <div class="login-footer">
                <p>Only authorized Google accounts can access this panel.</p>
            </div>
        </div>
    </div>
    
    <div class="header">
        <div class="header-content">
            <div>
                <h1>Adventure Directory Admin</h1>
                <p>Manage listings with full CRUD operations</p>
            </div>
            <div class="header-buttons">
                <button class="btn btn-secondary" onclick="logout()" style="background: #dc3545; border-color: #dc3545;">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 6px;">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16 17 21 12 16 7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    Logout
                </button>
                <button class="btn btn-success" onclick="openAddModal()">+ Add New Listing</button>
            </div>
        </div>
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('admin')">Admin</button>
            <button class="tab-btn" onclick="switchTab('data')">Data Table</button>
            <button class="tab-btn" onclick="switchTab('settings')">Settings</button>
            <button class="tab-btn" onclick="switchTab('code')">Code</button>
            <button class="tab-btn" onclick="switchTab('preview')">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px; margin-right: 6px;">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
                </svg>
                Preview
            </button>
            <button class="tab-btn" onclick="switchTab('deploy')">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px; margin-right: 6px;">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 16.5V9.75m0 0l3 3m-3-3l-3 3M6.75 19.5a4.5 4.5 0 01-1.41-8.775 5.25 5.25 0 0110.233-2.33 3 3 0 013.758 3.848A3.752 3.752 0 0118 19.5H6.75z" />
                </svg>
                Deploy
            </button>
        </div>
    </div>
    
    <div id="adminTab" class="tab-content active">
        <div class="stats">
            <div class="stat-card">
                <h3>Total Listings</h3>
                <p id="totalListings">15</p>
            </div>
            <div class="stat-card">
                <h3>Featured</h3>
                <p id="featuredCount">5</p>
            </div>
            <div class="stat-card">
                <h3>Areas Covered</h3>
                <p id="areasCount">6</p>
            </div>
            <div class="stat-card">
                <h3>Types</h3>
                <p id="typesCount">8</p>
            </div>
        </div>
        
        <!-- Google Sheets Status Section -->
        <div class="google-sheets-status-section" style="max-width: 1400px; margin: 30px auto; padding: 20px 20px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 8px; border-left: 4px solid #34a853; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                <div>
                    <h3 style="margin: 0 0 5px 0; color: #34a853; display: flex; align-items: center; gap: 8px;">
                        <span>üìä</span> Google Sheets Integration
                    </h3>
                    <p style="margin: 0; color: #666; font-size: 14px;">All changes sync to your Google Sheet. Make sure your Apps Script is configured to accept JSON POST requests.</p>
                </div>
                <div id="sheetsStatusBadge" style="padding: 6px 12px; background: #34a853; color: white; border-radius: 20px; font-size: 12px; font-weight: 600; display: flex; align-items: center; gap: 6px;">
                    <span id="sheetsStatusIcon">‚úì</span>
                    <span id="sheetsStatusText">Connected</span>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; background: white; padding: 15px; border-radius: 6px;">
                <div>
                    <label style="display: block; font-weight: 600; margin-bottom: 5px; color: #333;">Apps Script URL:</label>
                    <input type="text" id="sheetsScriptUrl" value="https://script.google.com/macros/s/AKfycbwNH8P5P8iorzRTTx3FpVbYPFNBo1qUWIU630v7ymLJWypvJpSEfPZC5nfxJpjjwjF-Jg/exec" readonly
                           style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace; font-size: 11px; background: #f8f9fa; cursor: text;"
                           onclick="this.select();">
                    <small style="color: #666;">Click to copy</small>
                </div>
                
                <div>
                    <label style="display: block; font-weight: 600; margin-bottom: 5px; color: #333;">Last Sync:</label>
                    <div id="lastSyncTime" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #f8f9fa; color: #666;">
                        Loading...
                    </div>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                <button onclick="reloadFromSheets()" 
                        style="background: #4285f4; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 6px;">
                    <span>üîÑ</span> Reload from Google Sheets
                </button>
                <button onclick="saveAllToSheets()"
                        style="background: #34a853; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 6px;">
                    <span>üíæ</span> Save All to Google Sheets
                </button>
                <button onclick="downloadCSV()"
                        style="background: #4E6B52; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 6px;">
                    <span>üì•</span> Download CSV Backup
                </button>
                <div id="sheetsActionStatus" style="margin-left: auto; font-weight: 600; color: #34a853;"></div>
            </div>
        </div>
        
        <div class="preview-container">
            <div class="preview-content-wrapper">
                <aside class="preview-sidebar">
                    <div class="preview-filters">
                        <h3>Filters</h3>
                        
                        <div class="filter-content">
                            <div class="filter-section search-section">
                                <div class="preview-search">
                                    <label>Search Listings</label>
                                    <input type="text" id="adminSearchInput" placeholder="Search by name, type, area, or description..." onkeyup="filterListings()" />
                                </div>
                            </div>
                            
                            <div class="filter-section">
                                <div class="type-quick-filters">
                                    <button class="type-filter-btn active" data-type="" onclick="filterAdminByType('')">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
                                        </svg>
                                        All Types
                                    </button>
                                    <button class="type-filter-btn" data-type="Brewery" onclick="filterAdminByType('Brewery')">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M6 18h12v2H6zm1-14h10l1 10H6z"/>
                                            <path d="M9 6v8m3-8v8m3-8v8"/>
                                        </svg>
                                        Brewery
                                    </button>
                                    <button class="type-filter-btn" data-type="Winery" onclick="filterAdminByType('Winery')">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M8 2v7c0 4 2 7 4 7s4-3 4-7V2"/>
                                            <path d="M6 8h12"/>
                                            <path d="M12 16v6"/>
                                            <circle cx="12" cy="22" r="1"/>
                                        </svg>
                                        Winery
                                    </button>
                                    <button class="type-filter-btn" data-type="Hiking" onclick="filterAdminByType('Hiking')">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M6 20h4c1 0 2-1 2-2V8c0-1-1-2-2-2H6c-1 0-2 1-2 2v10c0 1 1 2 2 2z"/>
                                            <path d="M14 20h4c1 0 2-1 2-2V8c0-1-1-2-2-2h-4c-1 0-2 1-2 2v10c0 1 1 2 2 2z"/>
                                            <path d="M6 8h4m8 0h4M10 2v4m4-4v4"/>
                                        </svg>
                                        Hiking
                                    </button>
                                    <button class="type-filter-btn" data-type="Restaurant" onclick="filterAdminByType('Restaurant')">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M3 2v7c0 1.1.9 2 2 2h0v11h2V11h0c1.1 0 2-.9 2-2V2M17 2v11h2V2M15 8h6M17 22v-9"/>
                                        </svg>
                                        Restaurant
                                    </button>
                                    <button class="type-filter-btn" data-type="Lodging" onclick="filterAdminByType('Lodging')">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/>
                                            <path d="M9 22V12h6v10"/>
                                        </svg>
                                        Lodging
                                    </button>
                                    <button class="type-filter-btn" data-type="Activity" onclick="filterAdminByType('Activity')">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="5" r="2"/>
                                            <path d="M10 22v-8m0 0l-2-2m2 2l2-2"/>
                                            <path d="M7 12l3-3 3 1 4-4"/>
                                            <path d="M17 8l2 2"/>
                                        </svg>
                                        Activity
                                    </button>
                                </div>
                            </div>
                            
                            <div class="filter-section">
                                <div class="preview-filter-group">
                                    <label>Area</label>
                                    <select id="adminAreaFilter" onchange="filterListings()">
                                        <option value="">All Areas</option>
                                    </select>
                                </div>
                                
                                <div class="preview-filter-group">
                                    <label>Amenities</label>
                                    <select id="adminAmenityFilter" onchange="filterListings()">
                                        <option value="">All Amenities</option>
                                    </select>
                                </div>
                                
                                <button class="btn btn-secondary" onclick="clearAdminFilters()">Clear Filters</button>
                            </div>
                        </div>
                    </div>
                </aside>
                
                <main class="preview-main">
                    <h2 class="section-title">All Listings</h2>
                    <div id="listingsGrid" class="listings-grid"></div>
                </main>
            </div>
        </div>
    </div>
    
    <div id="previewTab" class="tab-content">
        <div class="preview-controls">
            <button class="back-to-admin" onclick="switchTab('admin')">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
                </svg>
                Back to Admin
            </button>
            <button class="preview-dark-toggle" onclick="toggleDarkMode()" id="previewDarkToggle">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
            </button>
        </div>
        <div class="preview-container">
            <div class="preview-content-wrapper">
                <aside class="preview-sidebar">
                    <div class="preview-filters">
                        <h3>Filters</h3>
                        
                        <div class="filter-content">
                            <div class="filter-section search-section">
                                <div class="preview-search">
                                    <label>Search Listings</label>
                                    <input type="text" id="previewSearchInput" placeholder="Search by name, type, area, or description..." onkeyup="filterPreview()" />
                                </div>
                            </div>
                            
                            <div class="filter-section">
                                <div class="type-quick-filters">
                                    <button class="type-filter-btn active" data-type="">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
                                        </svg>
                                        All Types
                                    </button>
                                    <button class="type-filter-btn" data-type="Brewery">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" />
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 13.5a3 3 0 100-6 3 3 0 000 6z" />
                                        </svg>
                                        Brewery
                                    </button>
                                    <button class="type-filter-btn" data-type="Winery">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25z" />
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6l4 2" />
                                        </svg>
                                        Winery
                                    </button>
                                    <button class="type-filter-btn" data-type="Hiking">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z" />
                                        </svg>
                                        Hiking
                                    </button>
                                    <button class="type-filter-btn" data-type="Restaurant">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                                        </svg>
                                        Restaurant
                                    </button>
                                    <button class="type-filter-btn" data-type="Lodging">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
                                        </svg>
                                        Lodging
                                    </button>
                                    <button class="type-filter-btn" data-type="Activity">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z" />
                                        </svg>
                                        Activity
                                    </button>
                                </div>
                            </div>
                            
                            <div class="filter-section">
                                <div class="preview-filter-group">
                                    <label>Area</label>
                                    <select id="previewAreaFilter" onchange="filterPreview()">
                                        <option value="">All Areas</option>
                                    </select>
                                </div>
                                
                                <div class="preview-filter-group">
                                    <label>Amenities</label>
                                    <select id="previewAmenityFilter" onchange="filterPreview()">
                                        <option value="">All Amenities</option>
                                    </select>
                                </div>
                                
                                <button class="btn btn-secondary" onclick="clearPreviewFilters()">Clear Filters</button>
                            </div>
                        </div>
                    </div>
                </aside>
                
                <main class="preview-main">
                    <div class="preview-header">
                        <h1>Explore Nelson County Adventures</h1>
                        <p>Discover breweries, wineries, hiking trails, and outdoor activities</p>
                    </div>
                    
                    <div class="preview-results">
                        <span id="previewResultsCount">Showing 15 listings</span>
                    </div>
                    
                    <div id="previewGrid" class="preview-grid"></div>
                    
                    <!-- Overlay for flipped cards -->
                    <div id="flipOverlay" class="flip-overlay" onclick="closeAllFlippedCards()"></div>
                </main>
            </div>
        </div>
    </div>
    
    <div id="dataTab" class="tab-content">
        <div class="data-container">
            <div class="data-header">
                <h2>Data Table</h2>
                <div class="data-actions">
                    <input type="file" id="csvUpload" accept=".csv" style="display: none;" onchange="handleCSVUpload(event)" />
                    <button class="btn btn-primary" onclick="document.getElementById('csvUpload').click()">Upload CSV</button>
                    <button class="btn btn-success" onclick="downloadCSV()">Download CSV</button>
                    <button class="btn btn-success" onclick="saveTableChanges()" style="background: #4E6B52;">Update Table</button>
                </div>
            </div>
            <div class="table-wrapper">
                <table id="dataTable" class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Type</th>
                            <th>Area</th>
                            <th>Description</th>
                            <th>Image 1</th>
                            <th>Image 2</th>
                            <th>Website</th>
                            <th>Phone</th>
                            <th>Address</th>
                            <th>Amenities</th>
                            <th>Featured</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="dataTableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div id="settingsTab" class="tab-content">
        <div class="settings-container" style="max-width: 1200px; margin: 0 auto; padding: 20px;">
            <div style="margin-bottom: 30px;">
                <h2 style="margin: 0 0 10px 0; color: #212529;">Field Configuration</h2>
                <p style="color: #6c757d; margin: 0;">Manage the options available in the Add/Edit listing form. Changes are saved automatically.</p>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px;">
                <!-- Types Section -->
                <div class="settings-card" style="background: white; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px;">
                    <h3 style="margin: 0 0 15px 0; color: #212529; font-size: 18px;">Types</h3>
                    <p style="color: #6c757d; font-size: 14px; margin: 0 0 15px 0;">Options for the "Type" dropdown in the listing form</p>
                    <div id="typesList" style="margin-bottom: 15px; max-height: 300px; overflow-y: auto;">
                        <!-- Types will be rendered here -->
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="newTypeInput" placeholder="Add new type..." style="flex: 1; padding: 8px; border: 1px solid #dee2e6; border-radius: 4px;" onkeypress="if(event.key==='Enter') addType()" />
                        <button onclick="addType()" class="btn btn-success" style="padding: 8px 16px;">Add</button>
                    </div>
                </div>
                
                <!-- Areas Section -->
                <div class="settings-card" style="background: white; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px;">
                    <h3 style="margin: 0 0 15px 0; color: #212529; font-size: 18px;">Areas</h3>
                    <p style="color: #6c757d; font-size: 14px; margin: 0 0 15px 0;">Options for the "Area" dropdown in the listing form</p>
                    <div id="areasList" style="margin-bottom: 15px; max-height: 300px; overflow-y: auto;">
                        <!-- Areas will be rendered here -->
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="newAreaInput" placeholder="Add new area..." style="flex: 1; padding: 8px; border: 1px solid #dee2e6; border-radius: 4px;" onkeypress="if(event.key==='Enter') addArea()" />
                        <button onclick="addArea()" class="btn btn-success" style="padding: 8px 16px;">Add</button>
                    </div>
                </div>
                
                <!-- Amenities Section -->
                <div class="settings-card" style="background: white; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; grid-column: 1 / -1;">
                    <h3 style="margin: 0 0 15px 0; color: #212529; font-size: 18px;">Amenities</h3>
                    <p style="color: #6c757d; font-size: 14px; margin: 0 0 15px 0;">Options for the "Amenities" checkboxes in the listing form</p>
                    <div id="amenitiesList" style="margin-bottom: 15px; max-height: 300px; overflow-y: auto; display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px;">
                        <!-- Amenities will be rendered here -->
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="newAmenityInput" placeholder="Add new amenity..." style="flex: 1; padding: 8px; border: 1px solid #dee2e6; border-radius: 4px;" onkeypress="if(event.key==='Enter') addAmenity()" />
                        <button onclick="addAmenity()" class="btn btn-success" style="padding: 8px 16px;">Add</button>
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #4E6B52;">
                <p style="margin: 0; color: #6c757d;">
                    <strong>Note:</strong> Changes are saved automatically. The form dropdowns and checkboxes will update immediately after you add or remove items.
                </p>
            </div>
        </div>
    </div>
    
    <div id="codeTab" class="tab-content">
        <div class="code-container">
            <div class="code-section">
                <div class="code-header">
                    <h3>Embed Code</h3>
                    <button class="btn btn-secondary btn-copy" onclick="copyCode('embed')">Copy</button>
                </div>
                <textarea id="embedCode" readonly></textarea>
            </div>
            
            <div class="code-section">
                <div class="code-header">
                    <h3>JSON Data</h3>
                    <button class="btn btn-secondary btn-copy" onclick="copyCode('json')">Copy</button>
                </div>
                <textarea id="jsonCode" readonly></textarea>
            </div>
            
            <div class="code-section">
                <div class="code-header">
                    <h3>CSS Styles</h3>
                    <button class="btn btn-secondary btn-copy" onclick="copyCode('css')">Copy</button>
                </div>
                <textarea id="cssCode" readonly></textarea>
            </div>
            
            <div class="code-section">
                <div class="code-header">
                    <h3>JavaScript</h3>
                    <button class="btn btn-secondary btn-copy" onclick="copyCode('js')">Copy</button>
                </div>
                <textarea id="jsCode" readonly></textarea>
            </div>
        </div>
    </div>
    
    <div id="learnTab" class="tab-content">
        <div class="data-container" style="max-width: 1000px; margin: 0 auto;">
            <div class="deploy-header">
                <h2>How the System Works</h2>
                <p style="color: var(--text-secondary); margin-top: 10px;">Understanding the complete workflow from Admin Panel to Google Sheets to Framer CMS</p>
            </div>
            
            <!-- System Overview -->
            <div style="background: linear-gradient(135deg, #4E6B52 0%, #3d5540 100%); color: white; padding: 30px; border-radius: 12px; margin-bottom: 40px;">
                <h2 style="color: white; margin: 0 0 15px 0; font-size: 28px;">System Architecture Overview</h2>
                <p style="color: rgba(255,255,255,0.9); margin: 0; line-height: 1.8; font-size: 16px;">
                    This system connects <strong>4 main components</strong> to create a seamless content management workflow:
                    <strong>Admin Panel</strong> ‚Üí <strong>Google Sheets</strong> ‚Üí <strong>Framer CMS</strong> ‚Üí <strong>Live Website</strong>
                </p>
                </div>
                
            <!-- Workflow Diagram Section -->
            <div class="deploy-steps">
                <div class="deploy-step">
                    <div class="deploy-step-number" style="background: linear-gradient(135deg, #4E6B52 0%, #3d5540 100%);">1</div>
                    <div class="deploy-step-content">
                        <h3>Admin Panel (This Interface)</h3>
                        <p><strong>What it is:</strong> Your local content management system where you create and edit listings.</p>
                        <ul>
                            <li><strong>Add/Edit Listings:</strong> Use the Admin tab to create new listings or modify existing ones</li>
                            <li><strong>Bulk Editing:</strong> Use the Data Table tab for spreadsheet-style editing</li>
                            <li><strong>Field Configuration:</strong> Use the Settings tab to customize Types, Areas, and Amenities</li>
                            <li><strong>Local Storage:</strong> Changes are saved in your browser's local storage (not synced yet)</li>
                        </ul>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #4E6B52;">
                            <strong>üí° Key Point:</strong> This is where you do all your content work. Changes here are local until you sync to Google Sheets.
                        </div>
                    </div>
                </div>
                
                <div class="deploy-step">
                    <div class="deploy-step-number" style="background: linear-gradient(135deg, #34a853 0%, #2d8f47 100%);">2</div>
                    <div class="deploy-step-content">
                        <h3>Google Sheets (Data Storage)</h3>
                        <p><strong>What it is:</strong> Your centralized database hosted in Google Sheets, accessible via Google Apps Script.</p>
                        <ul>
                            <li><strong>Sync Button:</strong> Click "Save All to Google Sheets" to upload your local changes</li>
                            <li><strong>Auto-Sync:</strong> The system automatically loads data from Sheets when you open the admin panel</li>
                            <li><strong>Google Apps Script:</strong> Acts as an API bridge between this admin panel and your Google Sheet</li>
                            <li><strong>Backup:</strong> Always download a CSV backup before syncing to avoid data loss</li>
                        </ul>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #34a853;">
                            <strong>üí° Key Point:</strong> Google Sheets is your "source of truth" - it's where Framer CMS will pull data from.
                    </div>
                        <div style="background: #fff3cd; padding: 12px; border-radius: 8px; margin-top: 12px; border-left: 4px solid #ffc107;">
                            <strong>‚ö†Ô∏è Important:</strong> Make sure your Google Apps Script is deployed with "Anyone" access and reads from <code>e.postData.contents</code> for CORS to work properly.
                </div>
                    </div>
                </div>
                
                <div class="deploy-step">
                    <div class="deploy-step-number" style="background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);">3</div>
                    <div class="deploy-step-content">
                        <h3>Framer CMS Integration</h3>
                        <p><strong>What it is:</strong> Framer's CMS system that connects to your Google Sheet to display listings on your website.</p>
                        <ul>
                            <li><strong>CMS Collection:</strong> Set up a CMS collection in Framer that pulls from your Google Sheet</li>
                            <li><strong>Auto-Refresh:</strong> Framer periodically checks your Google Sheet for updates</li>
                            <li><strong>Real-time Updates:</strong> When you sync from Admin Panel ‚Üí Google Sheets, Framer will see the changes</li>
                            <li><strong>No Code Deployment:</strong> Unlike Squarespace, you don't need to replace code blocks</li>
                        </ul>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #6366f1;">
                            <strong>üí° Key Point:</strong> Once configured, Framer automatically displays whatever is in your Google Sheet - no manual code updates needed!
                        </div>
                        <div style="background: #e0e7ff; padding: 15px; border-radius: 8px; margin-top: 15px;">
                            <h4 style="margin: 0 0 10px 0; color: #4f46e5;">Setting Up Framer CMS:</h4>
                            <ol style="margin: 0; padding-left: 20px;">
                                <li>In Framer, go to <strong>CMS</strong> ‚Üí <strong>Add Collection</strong></li>
                                <li>Choose <strong>"Google Sheets"</strong> as your data source</li>
                                <li>Connect to your Google Sheet (the same one connected to Apps Script)</li>
                                <li>Map the columns to CMS fields (Name, Type, Area, Description, etc.)</li>
                                <li>Design your listing cards using the CMS data</li>
                            </ol>
                        </div>
                    </div>
                </div>
                
                <div class="deploy-step">
                    <div class="deploy-step-number" style="background: linear-gradient(135deg, #D65052 0%, #b84446 100%);">4</div>
                    <div class="deploy-step-content">
                        <h3>Live Website</h3>
                        <p><strong>What it is:</strong> Your published Framer site that visitors see.</p>
                        <ul>
                            <li><strong>Automatic Updates:</strong> When Framer CMS refreshes, your live site updates automatically</li>
                            <li><strong>No Downtime:</strong> Changes appear seamlessly without site downtime</li>
                            <li><strong>Preview Mode:</strong> Test changes in Framer's preview before publishing</li>
                            <li><strong>Publishing:</strong> Once you publish in Framer, changes go live immediately</li>
                        </ul>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 15px; border-left: 4px solid #D65052;">
                            <strong>üí° Key Point:</strong> The live site is the final destination - it automatically reflects what's in your Google Sheet via Framer CMS.
                    </div>
                </div>
                    </div>
                </div>
                
            <!-- Complete Workflow Section -->
                <div style="margin-top: 60px; padding-top: 40px; border-top: 2px solid var(--border-color);">
                    <div class="deploy-header" style="margin-bottom: 30px;">
                        <h2 style="display: flex; align-items: center; gap: 12px;">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="width: 32px; height: 32px; color: #4E6B52;">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z" />
                            </svg>
                        Complete Workflow: Making Changes
                        </h2>
                    <p style="color: var(--text-secondary); margin-top: 10px;">Follow these steps whenever you want to update your listings</p>
                    </div>
                    
                    <div class="deploy-steps">
                        <div class="deploy-step">
                        <div class="deploy-step-number" style="background: linear-gradient(135deg, #4E6B52 0%, #3d5540 100%);">1</div>
                            <div class="deploy-step-content">
                            <h3>Edit in Admin Panel</h3>
                            <p>Make your changes here:</p>
                            <ul>
                                <li>Open this admin panel HTML file in your browser</li>
                                <li>Go to <strong>Admin</strong> tab to add/edit individual listings</li>
                                <li>Or use <strong>Data Table</strong> tab for bulk editing</li>
                                <li>Use <strong>Settings</strong> tab to manage form fields (Types, Areas, Amenities)</li>
                                </ul>
                            <p style="margin-top: 12px; padding: 12px; background: #f0f9ff; border-left: 4px solid #0ea5e9; border-radius: 4px;">
                                <strong>üìù Note:</strong> Changes are saved locally in your browser. They won't appear on your website until you sync to Google Sheets.
                            </p>
                            </div>
                        </div>
                        
                        <div class="deploy-step">
                        <div class="deploy-step-number" style="background: linear-gradient(135deg, #34a853 0%, #2d8f47 100%);">2</div>
                            <div class="deploy-step-content">
                            <h3>Sync to Google Sheets</h3>
                            <p>Push your changes to the cloud:</p>
                            <ul>
                                <li>Click <strong>"Save All to Google Sheets"</strong> button (top of Admin tab)</li>
                                <li>You'll be prompted to download a CSV backup first (recommended!)</li>
                                <li>Confirm the sync - this replaces all data in your Google Sheet</li>
                                <li>Wait for the success message: "‚úÖ Replaced all data in Google Sheets"</li>
                                </ul>
                            <div style="background: #fff3cd; padding: 12px; border-radius: 8px; margin-top: 12px; border-left: 4px solid #ffc107;">
                                <strong>‚ö†Ô∏è Important:</strong> This step overwrites your Google Sheet. Always download a backup first if you're unsure!
                            </div>
                            </div>
                        </div>
                        
                        <div class="deploy-step">
                        <div class="deploy-step-number" style="background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);">3</div>
                            <div class="deploy-step-content">
                            <h3>Framer CMS Auto-Refresh</h3>
                            <p>Framer automatically picks up the changes:</p>
                            <ul>
                                <li>Framer CMS checks your Google Sheet periodically (usually every few minutes)</li>
                                <li>When it detects changes, it automatically updates the CMS collection</li>
                                <li>You can manually refresh in Framer: <strong>CMS</strong> ‚Üí <strong>Refresh Collection</strong></li>
                                <li>Preview your changes in Framer's preview mode</li>
                                </ul>
                            <div style="background: #e0e7ff; padding: 12px; border-radius: 8px; margin-top: 12px; border-left: 4px solid #6366f1;">
                                <strong>üí° Tip:</strong> If changes don't appear immediately, try manually refreshing the CMS collection in Framer.
                            </div>
                            </div>
                        </div>
                        
                        <div class="deploy-step">
                            <div class="deploy-step-number" style="background: linear-gradient(135deg, #D65052 0%, #b84446 100%);">4</div>
                            <div class="deploy-step-content">
                            <h3>Publish in Framer</h3>
                            <p>Make changes live on your website:</p>
                            <ul>
                                <li>Review your changes in Framer's preview</li>
                                <li>Click <strong>Publish</strong> in Framer</li>
                                <li>Changes go live immediately on your website</li>
                                <li>No code editing needed - it's all automatic!</li>
                                </ul>
                            <div style="background: #fee2e2; padding: 12px; border-radius: 8px; margin-top: 12px; border-left: 4px solid #D65052;">
                                <strong>‚úÖ That's it!</strong> Your workflow is complete: Admin Panel ‚Üí Google Sheets ‚Üí Framer CMS ‚Üí Live Site
                            </div>
                        </div>
                    </div>
                        </div>
                    </div>
                    
            <!-- Important Information Section -->
                <div style="margin-top: 60px; padding-top: 40px; border-top: 2px solid var(--border-color);">
                    <div class="deploy-header" style="margin-bottom: 30px;">
                        <h2 style="display: flex; align-items: center; gap: 12px;">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="width: 32px; height: 32px; color: #4E6B52;">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
                            </svg>
                        Important Things to Know
                        </h2>
                    </div>
                    
                    <div class="deploy-steps">
                        <div class="deploy-step">
                        <div class="deploy-step-number" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">‚ö†Ô∏è</div>
                            <div class="deploy-step-content">
                            <h3>Data Safety & Backups</h3>
                            <ul>
                                <li><strong>Always Backup First:</strong> Download CSV backup before syncing to Google Sheets</li>
                                <li><strong>Local Storage:</strong> Your changes are saved locally in your browser - they persist between sessions on the same computer</li>
                                <li><strong>Google Sheets is Source of Truth:</strong> Once synced, Google Sheets becomes the authoritative data source</li>
                                <li><strong>Multiple Devices:</strong> If you use this admin panel on different computers, sync to Google Sheets to share data</li>
                                    </ul>
                                            </div>
                                        </div>
                                        
                    <div class="deploy-step">
                        <div class="deploy-step-number" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">üîß</div>
                        <div class="deploy-step-content">
                            <h3>Google Apps Script Configuration</h3>
                            <p>Your Apps Script must be properly configured:</p>
                            <ul>
                                <li><strong>Deployment:</strong> Must be deployed as a "Web app" with "Anyone" access</li>
                                <li><strong>CORS:</strong> Script must read from <code>e.postData.contents</code> (not <code>e.parameter.data</code>)</li>
                                <li><strong>URL:</strong> Copy the deployment URL and paste it in the admin panel configuration</li>
                                <li><strong>New Deployments:</strong> If you update the script, create a new deployment (don't just update)</li>
                                            </ul>
                            <div style="background: #f3f4f6; padding: 12px; border-radius: 8px; margin-top: 12px;">
                                <strong>Script File:</strong> See <code>nelson-county-apps-script.gs</code> for the complete, ready-to-use script.
                                        </div>
                                            </div>
                                        </div>
                                        
                    <div class="deploy-step">
                        <div class="deploy-step-number" style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);">üìä</div>
                        <div class="deploy-step-content">
                            <h3>Google Sheet Structure</h3>
                            <p>Your Google Sheet should have these columns (in any order):</p>
                            <ul>
                                <li><strong>id</strong> - Unique identifier for each listing</li>
                                <li><strong>name</strong> - Listing name/title</li>
                                <li><strong>type</strong> - Category (Brewery, Winery, etc.)</li>
                                <li><strong>area</strong> - Location area</li>
                                <li><strong>description</strong> - Full description text</li>
                                <li><strong>image1</strong> - Primary image URL</li>
                                <li><strong>image2</strong> - Secondary image URL (optional)</li>
                                <li><strong>website</strong> - External website URL</li>
                                <li><strong>phone</strong> - Contact phone number</li>
                                <li><strong>address</strong> - Physical address</li>
                                <li><strong>amenities</strong> - Comma or semicolon-separated list</li>
                                <li><strong>featured</strong> - TRUE or FALSE</li>
                                            </ul>
                            <div style="background: #f0fdf4; padding: 12px; border-radius: 8px; margin-top: 12px; border-left: 4px solid #22c55e;">
                                <strong>üí° Tip:</strong> The Apps Script automatically handles different column orders and missing fields.
                                        </div>
                                            </div>
                                        </div>
                                        
                    <div class="deploy-step">
                        <div class="deploy-step-number" style="background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);">üé®</div>
                        <div class="deploy-step-content">
                            <h3>Framer CMS Setup Tips</h3>
                            <ul>
                                <li><strong>Sheet Sharing:</strong> Make sure your Google Sheet is shared (view access) or published</li>
                                <li><strong>Column Names:</strong> Framer CMS will automatically detect column names from your sheet header row</li>
                                <li><strong>Refresh Rate:</strong> Framer checks for updates every few minutes - you can manually refresh</li>
                                <li><strong>Data Types:</strong> Framer will auto-detect data types (text, number, image URL, etc.)</li>
                                <li><strong>Multiple Collections:</strong> You can create separate CMS collections for different views/filters</li>
                                            </ul>
                            <div style="background: #fce7f3; padding: 12px; border-radius: 8px; margin-top: 12px; border-left: 4px solid #ec4899;">
                                <strong>üí° Pro Tip:</strong> Use Framer's CMS filtering and sorting features to create dynamic, filtered views without additional code.
                                        </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                <!-- Troubleshooting Section -->
                <div style="margin-top: 60px; padding-top: 40px; border-top: 2px solid var(--border-color);">
                    <div class="deploy-header" style="margin-bottom: 30px;">
                        <h2 style="display: flex; align-items: center; gap: 12px;">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="width: 32px; height: 32px; color: #4E6B52;">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                                                </svg>
                            Troubleshooting
                        </h2>
                                </div>
                                
                    <div class="deploy-tips" style="border-color: #f59e0b;">
                        <div class="deploy-tip-header" style="color: #f59e0b;">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="width: 24px; height: 24px; margin-right: 12px;">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 014.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 15.3M14.25 3.104c.251.023.501.05.75.082M19.8 15.3l-1.57.393A9.065 9.065 0 0112 15a9.065 9.065 0 00-6.23-.693L5 14.5m14.8.8l1.57.393A9.065 9.065 0 0021.75 12a9.065 9.065 0 00-6.23-.693m0 0l-1.57-.393M5 14.5l1.57-.393M5 14.5l-1.57.393M12 15.75l-1.57-.393M12 15.75l1.57-.393" />
                            </svg>
                            <h3>Common Issues & Solutions</h3>
                                </div>
                        <ul>
                            <li><strong>CORS Errors:</strong> Make sure Apps Script is deployed with "Anyone" access and uses <code>e.postData.contents</code>. Try creating a new deployment if issues persist.</li>
                            <li><strong>Data Not Syncing:</strong> Check that your Apps Script URL is correct in the admin panel. Verify the script is deployed and active.</li>
                            <li><strong>Framer Not Updating:</strong> Manually refresh the CMS collection in Framer. Check that your Google Sheet is properly shared/published.</li>
                            <li><strong>Missing Fields:</strong> Ensure your Google Sheet has the required columns (id, name, type, area, description, etc.)</li>
                            <li><strong>Local Changes Lost:</strong> Always sync to Google Sheets before closing the admin panel if you want to keep changes across devices.</li>
                                </ul>
                            </div>
                        </div>
                        
                <!-- Quick Reference -->
                <div style="margin-top: 60px; padding-top: 40px; border-top: 2px solid var(--border-color);">
                    <div class="deploy-header" style="margin-bottom: 30px;">
                        <h2 style="display: flex; align-items: center; gap: 12px;">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="width: 32px; height: 32px; color: #4E6B52;">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z" />
                            </svg>
                            Quick Reference
                        </h2>
                                </div>
                                
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div style="background: white; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px;">
                            <h4 style="margin: 0 0 10px 0; color: #4E6B52;">üìù Admin Panel</h4>
                            <ul style="margin: 0; padding-left: 20px; font-size: 14px;">
                                <li>Edit listings locally</li>
                                <li>Manage field options</li>
                                <li>Download backups</li>
                                <li>Sync to Sheets</li>
                            </ul>
                        </div>
                        
                        <div style="background: white; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px;">
                            <h4 style="margin: 0 0 10px 0; color: #34a853;">üìä Google Sheets</h4>
                            <ul style="margin: 0; padding-left: 20px; font-size: 14px;">
                                <li>Central data storage</li>
                                <li>Accessed via Apps Script</li>
                                <li>Source for Framer CMS</li>
                                <li>Always backup first!</li>
                                </ul>
                        </div>
                        
                        <div style="background: white; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px;">
                            <h4 style="margin: 0 0 10px 0; color: #6366f1;">üé® Framer CMS</h4>
                            <ul style="margin: 0; padding-left: 20px; font-size: 14px;">
                                <li>Auto-refreshes from Sheets</li>
                                <li>No code deployment needed</li>
                                <li>Design with CMS data</li>
                                <li>Publish to go live</li>
                                </ul>
                    </div>
                    
                        <div style="background: white; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px;">
                            <h4 style="margin: 0 0 10px 0; color: #D65052;">üåê Live Site</h4>
                            <ul style="margin: 0; padding-left: 20px; font-size: 14px;">
                                <li>Automatic updates</li>
                                <li>No downtime</li>
                                <li>Reflects Sheet data</li>
                                <li>Always current</li>
                        </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="listingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Add New Listing</h2>
                <button class="close-modal" onclick="closeModal()">&times;</button>
            </div>
            
            <form id="listingForm" onsubmit="saveListing(event)">
                <input type="hidden" id="editingId" />
                
                <div class="form-group">
                    <label>Listing Name *</label>
                    <input type="text" id="listingName" required />
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Type *</label>
                        <select id="listingType" required>
                            <option value="">Select Type</option>
                            <!-- Options will be populated dynamically -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Area *</label>
                        <select id="listingArea" required>
                            <option value="">Select Area</option>
                            <!-- Options will be populated dynamically -->
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Description *</label>
                    <textarea id="listingDescription" required></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Image URL 1 *</label>
                        <input type="text" id="listingImage1" required placeholder="https:// or data:image..." />
                    </div>
                    
                    <div class="form-group">
                        <label>Image URL 2</label>
                        <input type="text" id="listingImage2" placeholder="https:// or data:image..." />
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Website *</label>
                        <input type="url" id="listingWebsite" required placeholder="https://..." />
                    </div>
                    
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" id="listingPhone" placeholder="(434) 123-4567" />
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Address *</label>
                    <input type="text" id="listingAddress" required />
                </div>
                
                <div class="form-group">
                    <label>Amenities</label>
                    <div class="checkbox-group" id="amenitiesCheckboxes"></div>
                </div>
                
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" id="listingFeatured" style="width: auto;" />
                        Mark as Featured
                    </label>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn btn-success">Save Listing</button>
                </div>
            </form>
        </div>
    </div>
    
    <script src="https://ernestdarrow.github.io/nelsoncounty/admin.js" defer onerror="console.error('Failed to load admin.js'); document.getElementById('loginError').style.display='block'; document.getElementById('loginErrorText').textContent='Failed to load admin.js. Please check that the file exists on GitHub Pages.';"></script>
    
    <script>
        // Fallback: If admin.js fails to load, show error after 2 seconds
        window.addEventListener('load', function() {
            setTimeout(function() {
                // Check if critical functions exist
                if (typeof initializeGoogleSignIn === 'undefined') {
            const errorDiv = document.getElementById('loginError');
                    const errorText = document.getElementById('loginErrorText');
                    const loadingMessage = document.getElementById('loadingMessage');
                    
                    if (loadingMessage) loadingMessage.style.display = 'none';
                    if (errorDiv && errorText) {
                        errorText.innerHTML = `
                            <strong>‚ö†Ô∏è JavaScript Error:</strong><br>
                            The admin.js file failed to load from GitHub Pages.<br>
                            <small>Please ensure:<br>
                            1. admin.js is committed and pushed to your GitHub repository<br>
                            2. GitHub Pages is enabled for your repository<br>
                            3. The file is accessible at: https://ernestdarrow.github.io/nelsoncounty/admin.js</small>
                        `;
                errorDiv.style.display = 'block';
                    }
                }
            }, 2000);
        });
    </script>

</body>
</html>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
