<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Google Sheets</title>
    <!-- Google Identity Services -->
    <script>
        // Prevents Google auto-initialization before our code runs
        // Google's script looks for g_id_onload function or element
        // We'll prevent it from auto-initializing by not providing either until ready
        window.g_id_onload = null;
    </script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <!-- Local Stylesheet for Admin Panel -->
    <link rel="stylesheet" href="admin.css">
    
    <!-- Quick check: If auth is disabled, hide login immediately -->
    <script>
        // Set skipAuth flag immediately (since admin.js has ENABLE_GOOGLE_AUTH = false)
        // This will be cleared by admin.js if auth is re-enabled
        localStorage.setItem('skipAuth', 'true');
        
        // Hide login overlay immediately
        function hideLoginOverlay() {
            const overlay = document.getElementById('loginOverlay');
            if (overlay) {
                overlay.style.display = 'none';
                document.body.classList.add('logged-in');
            }
        }
        
        // Try immediately
        if (document.body) {
            hideLoginOverlay();
        }
        
        // Also try when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', hideLoginOverlay);
        } else {
            hideLoginOverlay();
        }
        
        // Use MutationObserver as backup
        const observer = new MutationObserver(function(mutations) {
            hideLoginOverlay();
            observer.disconnect();
        });
        if (document.body) {
            observer.observe(document.body, { childList: true, subtree: true });
        }
    </script>
    
    <!-- Critical CSS for login page and initial UI -->
    <style>
        /* Basic reset and body styles */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: #ffffff; 
            color: #212529;
        }
        
        /* Login Overlay - Critical for initial page load */
        #loginOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #4E6B52 0%, #3a5240 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        
        #loginOverlay .login-container {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            max-width: 400px;
            width: 90%;
        }
        
        #loginOverlay h2 {
            color: #4E6B52;
            margin: 0 0 10px 0;
            font-size: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        #loginOverlay p {
            color: #6c757d;
            margin: 0;
            font-size: 14px;
        }
        
        #loginOverlay .login-footer {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #dee2e6;
            text-align: center;
        }
        
        #loginOverlay .login-footer p {
            font-size: 12px;
        }
        
        #g_id_onload {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            min-height: 50px;
            align-items: center;
        }
        
        #fallbackButtonContainer {
            display: none;
            margin-bottom: 20px;
        }
        
        #fallbackButtonContainer button {
            width: 100%;
            background: #4285f4;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: background 0.2s;
        }
        
        #fallbackButtonContainer button:hover {
            background: #357ae8;
        }
        
        #loadingMessage {
            color: #6c757d;
            padding: 20px;
            text-align: center;
        }
        
        #loginError {
            display: none;
            background: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 6px;
            font-size: 14px; 
            text-align: center;
            margin-bottom: 20px;
        }
        
        /* Hide login overlay when logged in */
        body.logged-in #loginOverlay {
            display: none;
        }
        
        /* Ensure content is hidden until logged in */
        body:not(.logged-in) .header,
        body:not(.logged-in) .tabs,
        body:not(.logged-in) .tab-content {
            display: none;
        }
    </style>

</head>
<body>
    <!-- Google OAuth Login Overlay -->
    <div id="loginOverlay">
        <div class="login-container">
            <div style="text-align: center; margin-bottom: 30px;">
                <h2>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                    </svg>
                    Nelson County
                </h2>
                <p>Sign in with your Google account to access the admin panel</p>
            </div>
            
            <div id="googleSignInContainer"></div>
            
            <!-- Fallback manual button if Google's button doesn't load -->
            <div id="fallbackButtonContainer">
                <button onclick="triggerGoogleSignIn()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                        <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                        <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                        <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                    </svg>
                    Sign in with Google
                </button>
                </div>
                
            <div id="loadingMessage">Loading sign-in button...</div>
                
            <div id="loginError">
                <span id="loginErrorText"></span>
            </div>
            
            <div class="login-footer">
                <p>Only authorized Google accounts can access this panel.</p>
            </div>
        </div>
    </div>
    
    <div class="header">
        <div class="header-content">
            <div>
                <h1>Adventure Directory Admin</h1>
                <p>Manage listings with full CRUD operations</p>
            </div>
            <div class="header-buttons">
                <button class="btn btn-secondary" onclick="logout()" style="background: #dc3545; border-color: #dc3545;">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align: middle; margin-right: 6px;">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16 17 21 12 16 7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    Logout
                </button>
                <button class="btn btn-success" onclick="openAddModal()">+ Add New Listing</button>
            </div>
        </div>
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('admin')">Admin</button>
            <button class="tab-btn" onclick="switchTab('data')">Data Table</button>
            <button class="tab-btn" onclick="switchTab('settings')">Settings</button>
        </div>
    </div>
    
    <div class="main-container">
    <div id="adminTab" class="tab-content active">
        <div class="stats">
            <div class="stat-card">
                <h3>Total Listings</h3>
                <p id="totalListings">15</p>
            </div>
            <div class="stat-card">
                <h3>Featured</h3>
                <p id="featuredCount">5</p>
            </div>
            <div class="stat-card">
                <h3>Areas Covered</h3>
                <p id="areasCount">6</p>
            </div>
            <div class="stat-card">
                <h3>Types</h3>
                <p id="typesCount">8</p>
            </div>
        </div>
        
        <!-- Google Sheets Status Section -->
        <div class="google-sheets-status-section" style="width: 100%; margin: 30px 0; padding: 20px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 8px; border-left: 4px solid #34a853; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                <div>
                    <h3 style="margin: 0 0 5px 0; color: #34a853; display: flex; align-items: center; gap: 8px;">
                        <span>üìä</span> Google Sheets Integration
                    </h3>
                    <p style="margin: 0; color: #666; font-size: 14px;">All changes sync to your Google Sheet. Make sure your Apps Script is configured to accept JSON POST requests.</p>
                </div>
                <div id="sheetsStatusBadge" style="padding: 6px 12px; background: #34a853; color: white; border-radius: 20px; font-size: 12px; font-weight: 600; display: flex; align-items: center; gap: 6px;">
                    <span id="sheetsStatusIcon">‚úì</span>
                    <span id="sheetsStatusText">Connected</span>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; background: white; padding: 15px; border-radius: 6px;">
                <div>
                    <label style="display: block; font-weight: 600; margin-bottom: 5px; color: #333;">Apps Script URL:</label>
                    <input type="text" id="sheetsScriptUrl" value="https://script.google.com/macros/s/AKfycbwNH8P5P8iorzRTTx3FpVbYPFNBo1qUWIU630v7ymLJWypvJpSEfPZC5nfxJpjjwjF-Jg/exec" readonly
                           style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace; font-size: 11px; background: #f8f9fa; cursor: text;"
                           onclick="this.select();">
                    <small style="color: #666;">Click to copy</small>
                </div>
                
                <div>
                    <label style="display: block; font-weight: 600; margin-bottom: 5px; color: #333;">Last Sync:</label>
                    <div id="lastSyncTime" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px; background: #f8f9fa; color: #666;">
                        Loading...
                    </div>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                <button onclick="reloadFromSheets()" 
                        style="background: #4285f4; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 6px;">
                    <span>üîÑ</span> Reload from Google Sheets
                </button>
                <button onclick="saveAllToSheets()"
                        style="background: #34a853; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 6px;">
                    <span>üíæ</span> Save All to Google Sheets
                </button>
                <button onclick="downloadCSV()"
                        style="background: #4E6B52; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 6px;">
                    <span>üì•</span> Download CSV Backup
                </button>
                <div id="sheetsActionStatus" style="margin-left: auto; font-weight: 600; color: #34a853;"></div>
            </div>
        </div>
        
        <div class="preview-container">
            <div class="preview-content-wrapper">
                <aside class="preview-sidebar">
                    <div class="preview-filters">
                        <div class="filter-content">
                            <div class="filter-section search-section">
                                <div class="preview-search">
                                    <label>Search Listings</label>
                                    <input type="text" id="adminSearchInput" placeholder="Search by name, type, area, or description..." onkeyup="filterListings()" />
                                </div>
                            </div>
                            
                            <div class="filter-section">
                                <div class="type-quick-filters">
                                    <button class="type-filter-btn active" data-type="" onclick="filterAdminByType('')">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
                                        </svg>
                                        All Types
                                    </button>
                                    <button class="type-filter-btn" data-type="Brewery" onclick="filterAdminByType('Brewery')">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M6 18h12v2H6zm1-14h10l1 10H6z"/>
                                            <path d="M9 6v8m3-8v8m3-8v8"/>
                                        </svg>
                                        Brewery
                                    </button>
                                    <button class="type-filter-btn" data-type="Winery" onclick="filterAdminByType('Winery')">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M8 2v7c0 4 2 7 4 7s4-3 4-7V2"/>
                                            <path d="M6 8h12"/>
                                            <path d="M12 16v6"/>
                                            <circle cx="12" cy="22" r="1"/>
                                        </svg>
                                        Winery
                                    </button>
                                    <button class="type-filter-btn" data-type="Hiking" onclick="filterAdminByType('Hiking')">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M6 20h4c1 0 2-1 2-2V8c0-1-1-2-2-2H6c-1 0-2 1-2 2v10c0 1 1 2 2 2z"/>
                                            <path d="M14 20h4c1 0 2-1 2-2V8c0-1-1-2-2-2h-4c-1 0-2 1-2 2v10c0 1 1 2 2 2z"/>
                                            <path d="M6 8h4m8 0h4M10 2v4m4-4v4"/>
                                        </svg>
                                        Hiking
                                    </button>
                                    <button class="type-filter-btn" data-type="Restaurant" onclick="filterAdminByType('Restaurant')">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M3 2v7c0 1.1.9 2 2 2h0v11h2V11h0c1.1 0 2-.9 2-2V2M17 2v11h2V2M15 8h6M17 22v-9"/>
                                        </svg>
                                        Restaurant
                                    </button>
                                    <button class="type-filter-btn" data-type="Lodging" onclick="filterAdminByType('Lodging')">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/>
                                            <path d="M9 22V12h6v10"/>
                                        </svg>
                                        Lodging
                                    </button>
                                    <button class="type-filter-btn" data-type="Activity" onclick="filterAdminByType('Activity')">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="5" r="2"/>
                                            <path d="M10 22v-8m0 0l-2-2m2 2l2-2"/>
                                            <path d="M7 12l3-3 3 1 4-4"/>
                                            <path d="M17 8l2 2"/>
                                        </svg>
                                        Activity
                                    </button>
                                </div>
                            </div>
                            
                            <div class="filter-section">
                                <div class="preview-filter-group">
                                    <label>Area</label>
                                    <select id="adminAreaFilter" onchange="filterListings()">
                                        <option value="">All Areas</option>
                                    </select>
                                </div>
                                
                                <div class="preview-filter-group">
                                    <label>Amenities</label>
                                    <select id="adminAmenityFilter" onchange="filterListings()">
                                        <option value="">All Amenities</option>
                                    </select>
                                </div>
                                
                                <button class="btn btn-secondary" onclick="clearAdminFilters()">Clear Filters</button>
                            </div>
                        </div>
                    </div>
                </aside>
                
                <main class="preview-main">
                    <h2 class="section-title">All Listings</h2>
                    <div id="listingsGrid" class="listings-grid"></div>
                </main>
            </div>
        </div>
    </div>
    
    <div id="dataTab" class="tab-content">
        <div class="data-container">
            <div class="data-header">
                <h2>Data Table</h2>
                <div class="data-actions">
                    <input type="file" id="csvUpload" accept=".csv" style="display: none;" onchange="handleCSVUpload(event)" />
                    <button class="btn btn-primary" onclick="document.getElementById('csvUpload').click()">Upload CSV</button>
                    <button class="btn btn-success" onclick="downloadCSV()">Download CSV</button>
                    <button class="btn btn-success" onclick="saveTableChanges()" style="background: #4E6B52;">Update Table</button>
                </div>
            </div>
            <div class="table-wrapper">
                <table id="dataTable" class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Slug</th>
                            <th>Type</th>
                            <th>Area</th>
                            <th>Description</th>
                            <th>Detailed Description</th>
                            <th>Image 1</th>
                            <th>Image 2</th>
                            <th>Image 3</th>
                            <th>Website</th>
                            <th>Phone</th>
                            <th>Address</th>
                            <th>Author Name</th>
                            <th>Published Date</th>
                            <th>Modified Date</th>
                            <th>Directions Link</th>
                            <th>Amenities</th>
                            <th>Featured</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="dataTableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div id="settingsTab" class="tab-content">
        <div class="settings-container" style="width: 100%; margin: 0; padding: 20px;">
            <div style="margin-bottom: 30px;">
                <h2 style="margin: 0 0 10px 0; color: #212529;">Field Configuration</h2>
                <p style="color: #6c757d; margin: 0;">Manage the options available in the Add/Edit listing form. Changes are saved automatically.</p>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px;">
                <!-- Types Section -->
                <div class="settings-card" style="background: white; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px;">
                    <h3 style="margin: 0 0 15px 0; color: #212529; font-size: 18px;">Types</h3>
                    <p style="color: #6c757d; font-size: 14px; margin: 0 0 15px 0;">Options for the "Type" dropdown in the listing form</p>
                    <div id="typesList" style="margin-bottom: 15px; max-height: 300px; overflow-y: auto;">
                        <!-- Types will be rendered here -->
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="newTypeInput" placeholder="Add new type..." style="flex: 1; padding: 8px; border: 1px solid #dee2e6; border-radius: 4px;" onkeypress="if(event.key==='Enter') addType()" />
                        <button onclick="addType()" class="btn btn-success" style="padding: 8px 16px;">Add</button>
                    </div>
                </div>
                
                <!-- Areas Section -->
                <div class="settings-card" style="background: white; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px;">
                    <h3 style="margin: 0 0 15px 0; color: #212529; font-size: 18px;">Areas</h3>
                    <p style="color: #6c757d; font-size: 14px; margin: 0 0 15px 0;">Options for the "Area" dropdown in the listing form</p>
                    <div id="areasList" style="margin-bottom: 15px; max-height: 300px; overflow-y: auto;">
                        <!-- Areas will be rendered here -->
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="newAreaInput" placeholder="Add new area..." style="flex: 1; padding: 8px; border: 1px solid #dee2e6; border-radius: 4px;" onkeypress="if(event.key==='Enter') addArea()" />
                        <button onclick="addArea()" class="btn btn-success" style="padding: 8px 16px;">Add</button>
                    </div>
                </div>
                
                <!-- Amenities Section -->
                <div class="settings-card" style="background: white; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; grid-column: 1 / -1;">
                    <h3 style="margin: 0 0 15px 0; color: #212529; font-size: 18px;">Amenities</h3>
                    <p style="color: #6c757d; font-size: 14px; margin: 0 0 15px 0;">Options for the "Amenities" checkboxes in the listing form</p>
                    <div id="amenitiesList" style="margin-bottom: 15px; max-height: 300px; overflow-y: auto; display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px;">
                        <!-- Amenities will be rendered here -->
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="newAmenityInput" placeholder="Add new amenity..." style="flex: 1; padding: 8px; border: 1px solid #dee2e6; border-radius: 4px;" onkeypress="if(event.key==='Enter') addAmenity()" />
                        <button onclick="addAmenity()" class="btn btn-success" style="padding: 8px 16px;">Add</button>
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #4E6B52;">
                <p style="margin: 0; color: #6c757d;">
                    <strong>Note:</strong> Changes are saved automatically. The form dropdowns and checkboxes will update immediately after you add or remove items.
                </p>
            </div>
        </div>
    </div>
    
    <div id="listingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Add New Listing</h2>
                <button class="close-modal" onclick="closeModal()">&times;</button>
            </div>
            
            <form id="listingForm" onsubmit="saveListing(event)">
                <input type="hidden" id="editingId" />
                
                <div class="form-group">
                    <label>Listing Name *</label>
                    <input type="text" id="listingName" required />
                </div>
                
                <div class="form-group">
                    <label>Slug</label>
                    <input type="text" id="listingSlug" placeholder="Leave blank to auto-generate" />
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Type *</label>
                        <select id="listingType" required>
                            <option value="">Select Type</option>
                            <!-- Options will be populated dynamically -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Area *</label>
                        <select id="listingArea" required>
                            <option value="">Select Area</option>
                            <!-- Options will be populated dynamically -->
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Description *</label>
                    <textarea id="listingDescription" required></textarea>
                </div>
                
                <div class="form-group">
                    <label>Detailed Description</label>
                    <textarea id="listingDetailedDescription" placeholder="Long-form copy for brochures, long reads, etc. Line breaks and paragraphs will be preserved." style="min-height: 150px;"></textarea>
                    <small style="color: #6c757d; font-size: 12px; margin-top: 5px; display: block;">Use line breaks (Enter) for new lines and double line breaks for paragraph spacing. This text appears on the back of cards when flipped.</small>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Image URL 1 *</label>
                        <div class="image-input-group">
                            <input type="text" id="listingImage1" required placeholder="https:// or data:image..." />
                            <button type="button" class="btn btn-secondary btn-upload-image" data-target="listingImage1">Upload</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Image URL 2</label>
                        <div class="image-input-group">
                            <input type="text" id="listingImage2" placeholder="https:// or data:image..." />
                            <button type="button" class="btn btn-secondary btn-upload-image" data-target="listingImage2">Upload</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Image URL 3</label>
                        <div class="image-input-group">
                            <input type="text" id="listingImage3" placeholder="https:// or data:image..." />
                            <button type="button" class="btn btn-secondary btn-upload-image" data-target="listingImage3">Upload</button>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Website *</label>
                        <input type="url" id="listingWebsite" required placeholder="https://..." />
                    </div>
                    
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" id="listingPhone" placeholder="(434) 123-4567" />
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Address *</label>
                    <input type="text" id="listingAddress" required />
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Author Name</label>
                        <input type="text" id="listingAuthorName" placeholder="e.g., Ernest Darrow" />
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Published Date</label>
                        <input type="date" id="listingPublishedDate" />
                    </div>
                    <div class="form-group">
                        <label>Modified Date</label>
                        <input type="date" id="listingModifiedDate" />
                    </div>
                </div>

                <div class="form-group">
                    <label>Directions Link</label>
                    <input type="url" id="listingDirectionsLink" placeholder="https://www.google.com/maps/..." />
                </div>
                
                <div class="form-group">
                    <label>Amenities</label>
                    <div class="checkbox-group" id="amenitiesCheckboxes"></div>
                </div>
                
                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" id="listingFeatured" style="width: auto;" />
                        Mark as Featured
                    </label>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn btn-success">Save Listing</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        // Test if functions are available
        window.addEventListener('load', function() {
            setTimeout(function() {
                console.log('Testing functions:', {
                    reloadFromSheets: typeof window.reloadFromSheets,
                    saveAllToSheets: typeof window.saveAllToSheets,
                    downloadCSV: typeof window.downloadCSV,
                    openAddModal: typeof window.openAddModal,
                    logout: typeof window.logout,
                    switchTab: typeof window.switchTab,
                    filterAdminByType: typeof window.filterAdminByType,
                    closeModal: typeof window.closeModal
                });
            }, 1000);
        });
    </script>
    <script src="admin.js"></script>
    
    <script>
        // Fallback: If admin.js fails to load, show error after 2 seconds
        window.addEventListener('load', function() {
            setTimeout(function() {
                // Check if critical functions exist
                if (typeof initializeGoogleSignIn === 'undefined') {
            const errorDiv = document.getElementById('loginError');
                    const errorText = document.getElementById('loginErrorText');
                    const loadingMessage = document.getElementById('loadingMessage');
                    
                    if (loadingMessage) loadingMessage.style.display = 'none';
                    if (errorDiv && errorText) {
                        errorText.innerHTML = `
                            <strong>‚ö†Ô∏è JavaScript Error:</strong><br>
                            The admin.js file failed to load from GitHub Pages.<br>
                            <small>Please ensure:<br>
                            1. admin.js is committed and pushed to your GitHub repository<br>
                            2. GitHub Pages is enabled for your repository<br>
                            3. The file is accessible at: https://ernestdarrow.github.io/nelsoncounty/admin.js</small>
                        `;
                errorDiv.style.display = 'block';
                    }
                }
            }, 2000);
        });
    </script>
    
    </div> <!-- End main-container -->

</body>
</html>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
