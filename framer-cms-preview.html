<!DOCTYPE html>
<html lang="en">
<head>
<title>Framer CSV Preview</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        background: #f7f7f7;
        color: #1f2933;
    }
    header {
        background: #1f2933;
        color: #ffffff;
        padding: 18px 24px;
    }
    header h1 {
        margin: 0;
        font-size: 20px;
        line-height: 1.3;
        font-weight: 600;
    }
    header p {
        margin: 6px 0 0 0;
        font-size: 13px;
        opacity: 0.8;
    }
    main {
        padding: 24px;
    }
    .status {
        background: #fff5d6;
        border: 1px solid #f6c555;
        border-radius: 8px;
        padding: 12px 16px;
        font-size: 13px;
        margin-bottom: 16px;
        display: none;
    }
    .status.error {
        background: #fde0dd;
        border-color: #f47067;
    }
    .fallback {
        display: none;
        margin-bottom: 18px;
    }
    .fallback.active {
        display: block;
    }
    .fallback label {
        display: inline-block;
        padding: 10px 16px;
        background: #1f2933;
        color: #ffffff;
        border-radius: 8px;
        font-size: 13px;
        cursor: pointer;
        font-weight: 600;
    }
    .fallback input {
        display: none;
    }
    .fallback small {
        display: block;
        margin-top: 8px;
        color: #475569;
        font-size: 12px;
    }
    .table-wrapper {
        background: #ffffff;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
        overflow: hidden;
        position: relative;
        border: 1px solid #e5e7eb;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        font-size: 12px;
        line-height: 1.4;
        table-layout: auto;
    }
    thead {
        position: sticky;
        top: 0;
        z-index: 2;
    }
    th {
        background: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);
        padding: 12px 14px;
        text-align: left;
        font-weight: 600;
        border-bottom: 1px solid #e2e8f0;
        color: #0f172a;
        white-space: nowrap;
    }
    tbody tr:nth-child(even) {
        background: #f9fafb;
    }
    td {
        padding: 10px 14px;
        border-bottom: 1px solid #edf2f7;
        vertical-align: top;
        white-space: normal;
        word-break: normal;
        overflow-wrap: anywhere;
    }
    tbody tr:hover {
        background: #eef2ff;
    }
    .table-scroll {
        max-height: 70vh;
        overflow: auto;
    }
    footer {
        font-size: 12px;
        color: #64748b;
        margin-top: 16px;
    }
    footer code {
        background: #e2e8f0;
        padding: 2px 6px;
        border-radius: 4px;
    }
</style>
</head>
<body>
<header>
    <h1>Framer CMS CSV Preview</h1>
    <p>Live view of <code>framer-cms-export.csv</code>. Changes to the CSV will appear on refresh.</p>
</header>
<main>
    <div id="status" class="status"></div>
    <div id="fallback" class="fallback">
        <label for="csvFile">Select CSV manually</label>
        <input type="file" id="csvFile" accept=".csv,text/csv">
        <small>For local previews opened from <code>file://</code>, browsers block fetch(). Choose the CSV and it will render instantly.</small>
    </div>
    <div class="table-wrapper">
        <div class="table-scroll">
            <table id="csv-table" aria-live="polite">
                <thead></thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    <footer>
        Data pulled on load. Ensure <code>framer-cms-export.csv</code> is hosted alongside this file.</footer>
</main>
<script>
(function() {
    const statusEl = document.getElementById('status');
    const table = document.getElementById('csv-table');
    const thead = table.querySelector('thead');
    const tbody = table.querySelector('tbody');
    const fallbackEl = document.getElementById('fallback');
    const fileInput = document.getElementById('csvFile');

    function setStatus(message, isError) {
        statusEl.textContent = message;
        statusEl.classList.toggle('error', !!isError);
        statusEl.style.display = message ? 'block' : 'none';
        fallbackEl.classList.toggle('active', !!isError);
    }

    function parseCSV(text) {
        const rows = [];
        let currentRow = [];
        let currentField = '';
        let inQuotes = false;

        for (let i = 0; i < text.length; i++) {
            const char = text[i];
            const nextChar = text[i + 1];

            if (char === '"') {
                if (inQuotes && nextChar === '"') {
                    currentField += '"';
                    i++;
                } else {
                    inQuotes = !inQuotes;
                }
            } else if (char === ',' && !inQuotes) {
                currentRow.push(currentField);
                currentField = '';
            } else if ((char === '\n' || char === '\r') && !inQuotes) {
                if (char === '\r' && nextChar === '\n') {
                    i++;
                }
                currentRow.push(currentField);
                if (currentRow.some(cell => cell.trim().length > 0)) {
                    rows.push(currentRow);
                }
                currentRow = [];
                currentField = '';
            } else {
                currentField += char;
            }
        }

        if (currentField.length > 0 || currentRow.length > 0) {
            currentRow.push(currentField);
            rows.push(currentRow);
        }

        return rows;
    }

    function renderTable(rows) {
        if (!rows.length) {
            setStatus('CSV file is empty.', true);
            return;
        }

        const headers = rows[0];
        const dataRows = rows.slice(1);

        thead.innerHTML = '<tr>' + headers.map(header => '<th scope="col">' + escapeHtml(header) + '</th>').join('') + '</tr>';

        const rowsHtml = dataRows.map(cells => {
            return '<tr>' + headers.map((_, idx) => '<td>' + escapeHtml(cells[idx] || '') + '</td>').join('') + '</tr>';
        }).join('');

        tbody.innerHTML = rowsHtml;
        setStatus('Loaded ' + dataRows.length + ' rows.', false);
    }

    function escapeHtml(value) {
        return (value || '').replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#39;');
    }

    function handleFileUpload(file) {
        if (!file) return;
        const reader = new FileReader();
        setStatus('Reading "' + file.name + '"…', false);
        reader.onload = function(event) {
            try {
                const rows = parseCSV(event.target.result || '');
                renderTable(rows);
                setStatus('Loaded ' + rows.length + ' rows from "' + file.name + '".', false);
            } catch (readerError) {
                console.error('Failed to parse uploaded CSV:', readerError);
                setStatus('Unable to parse uploaded file: ' + readerError.message, true);
            }
        };
        reader.onerror = function(event) {
            console.error('File read error:', event);
            setStatus('Could not read file: ' + (event.target.error?.message || 'Unknown error'), true);
        };
        reader.readAsText(file);
    }

    fileInput.addEventListener('change', function(event) {
        const file = event.target.files && event.target.files[0];
        handleFileUpload(file);
    });

    async function loadCSV() {
        try {
            setStatus('Loading CSV…', false);
            const response = await fetch('framer-cms-export.csv?_=' + Date.now());
            if (!response.ok) {
                throw new Error('HTTP ' + response.status + ' ' + response.statusText);
            }
            const text = await response.text();
            const rows = parseCSV(text);
            renderTable(rows);
        } catch (error) {
            console.error('Failed to load CSV:', error);
            setStatus('Unable to load CSV: ' + (error.message || error), true);
        }
    }

    loadCSV();
})();
</script>
</body>
</html>